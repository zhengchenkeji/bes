package com.ruoyi.deviceManagement.deviceTree.controller;

import com.ruoyi.common.core.controller.BaseController;
import com.ruoyi.common.core.domain.AjaxResult;
import com.ruoyi.deviceManagement.deviceTree.domain.DeviceTree;
import com.ruoyi.deviceManagement.deviceTree.service.DeviceTreeService;
import com.ruoyi.deviceManagement.deviceTreeNode.domain.AthenaDeviceNode;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import javax.annotation.Resource;
import java.util.List;

/**
 * @Author: wanghongjie
 * @Description:
 * @Date: Created in 15:05 2022/9/8
 * @Modified By:
 */
@RestController
@RequestMapping("/basicData/deviceTree")
public class DeviceTreeController extends BaseController {

    @Resource
    private DeviceTreeService deviceTreeService;

    /**
     * 查询设备树列表
     */
    @PreAuthorize("@ss.hasPermi('basicData:deviceTree:list')")
    @GetMapping("/listTree")
    public AjaxResult listTree(DeviceTree deviceTree) {
        List<DeviceTree> list = deviceTreeService.selectDeviceTreeList(deviceTree);
        return AjaxResult.success(list);
    }

    /**
     *
     * @Description: 获取所有的设备树节点
     *
     * @auther: wanghongjie
     * @date: 16:24 2022/10/24
     * @param:
     * @return:
     *
     */
    @PreAuthorize("@ss.hasPermi('basicData:deviceTree:allList')")
    @GetMapping("/allListTree")
    public AjaxResult allListTree(DeviceTree deviceTree) {
        AjaxResult ajaxResult = deviceTreeService.selectDeviceTreeAllList(deviceTree);
        return ajaxResult;
    }

    /**
     * @Description:删除树节点操作
     * @auther: wanghongjie
     * @date: 16:48 2022/9/16
     * @param:
     * @return:
     */
    @PreAuthorize("@ss.hasPermi('basicData:deviceTree:remove')")
    @PostMapping("/deleteTreeNode")
    public AjaxResult deleteTreeNode(DeviceTree deviceTree) {
        AjaxResult ajaxResult = deviceTreeService.deleteTreeNode(deviceTree);

        return ajaxResult;
    }


    /**
     * @Description: 根据节点类型查询相应的按钮
     * @auther: wanghongjie
     * @date: 11:40 2022/9/9
     * @param:
     * @return:
     */
    @PreAuthorize("@ss.hasPermi('basicData:deviceTree:getButtonByTreeType')")
    @PostMapping("/getButtonByTreeType")
    public AjaxResult getButtonByTreeType(AthenaDeviceNode deviceNode) {
        List<AthenaDeviceNode> list = deviceTreeService.getButtonByTreeType(deviceNode);
        if (list.size() == 0) {
            return AjaxResult.error("获取按钮失败");
        }
        return AjaxResult.success(list);
    }

    /**
     * @Description: 获取当前点击节点的详细信息
     * @auther: wanghongjie
     * @date: 10:54 2022/9/16
     * @param: [deviceNode]
     * @return: com.ruoyi.common.core.domain.AjaxResult
     */
    @PreAuthorize("@ss.hasPermi('basicData:deviceTree:getTreeNodeManage')")
    @GetMapping("/getTreeNodeManage")
    public AjaxResult getTreeNodeManage(DeviceTree deviceTree) {
        AjaxResult ajaxResult = deviceTreeService.getTreeNodeManage(deviceTree);

        return ajaxResult;
    }

    /**
     *
     * @Description: 根据点位id获取点位实时值
     *
     * @auther: wanghongjie
     * @date: 15:22 2022/11/2
     * @param:
     * @return:
     *
     */
    @PreAuthorize("@ss.hasPermi('basicData:deviceTree:getRealTimeData')")
    @GetMapping("/getRealTimeData")
    public AjaxResult getRealTimeData(Long id) {

        AjaxResult ajaxResult = deviceTreeService.getRealTimeData(id);

        return ajaxResult;
    }
}

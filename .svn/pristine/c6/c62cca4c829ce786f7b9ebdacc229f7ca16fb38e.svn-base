<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zc.efounder.JEnterprise.mapper.baseData.EquipmentMapper">
    
    <resultMap type="Equipment" id="AthenaBesEquipmentResult">
        <result property="id"    column="id"    />
        <result property="pId"    column="p_id"    />
        <result property="productId"    column="product_id"    />
        <result property="categoryId"    column="category_id"    />
        <result property="code"    column="code"    />
        <result property="name"    column="name"    />
        <result property="state"    column="state"    />
        <result property="ipAddress"    column="ip_address"    />
        <result property="sonAddress"    column="son_address"    />
        <result property="portNum"    column="port_num"    />
        <result property="networkType"    column="network_type"    />
        <result property="remark"    column="remark"    />
        <result property="communication"    column="communication"    />
        <result property="message"    column="message"    />
        <result property="iotName"    column="iotName"    />
        <result property="createTime"    column="create_time"    />
        <result property="createName"    column="create_name"    />
        <result property="updateTime"    column="update_time"    />
        <result property="updateName"    column="update_name"    />
    </resultMap>

    <sql id="selectAthenaBesEquipmentVo">
        select id, p_id, product_id, code, name, network_type, state, ip_address, son_address, port_num, remark, create_time, create_name, update_time, update_name from athena_bes_equipment
    </sql>

    <!--查询物联设备列表-->
    <select id="selectAthenaBesEquipmentList" parameterType="Equipment" resultMap="AthenaBesEquipmentResult">
        select t1.id, t1.product_id, t1.p_id, t1.code, t1.name, t1.state, t1.ip_address, t1.son_address, t1.port_num, t1.remark, t1.create_time,
        t1.create_name, t1.update_time, t1.update_name,t1.network_type,t2.category_id,
        (SELECT dict_label FROM sys_dict_data where dict_type = 'communication_protocol_product' and dict_value = t2.communication_protocol)
        communication,
        (SELECT agreement_name FROM athena_bes_agreement where id = t2.message_protocol)
        message,
        (SELECT dict_label FROM sys_dict_data where dict_type = 'iot_type' and dict_value = t2.iot_type) iotName
        from athena_bes_equipment t1
        left join athena_bes_product t2 on t1.product_id = t2.id
        <where>  
            <if test="productId != null "> and t1.product_id = #{productId}</if>
            <if test="code != null  and code != ''"> and t1.code = #{code}</if>
            <if test="name != null  and name != ''"> and t1.name like concat('%', #{name}, '%')</if>
            <if test="categoryId != null  and categoryId != ''"> and t2.category_id = #{categoryId}</if>
            <if test="pId != null  and pId != ''"> and t1.p_id = #{pId}</if>
            <if test="id != null  and id != ''"> and t1.id = #{id}</if>
        </where>
    </select>

    <!--查重物联设备-->
    <select id="selectAthenaBesEquipmentListCheck" parameterType="Equipment" resultMap="AthenaBesEquipmentResult">
        <include refid="selectAthenaBesEquipmentVo"/>
        <where>
            (code = #{code} or product_id = #{productId})
            <if test="id != null  and id != ''"> and id != #{id}</if>
        </where>
    </select>

    <!--查询物联设备子设备-->
    <select id="selectAthenaBesEquipmentSonList" parameterType="Long" resultMap="AthenaBesEquipmentResult">
        <include refid="selectAthenaBesEquipmentVo"/>
        where p_id = #{pId}
    </select>

    <!--查询物联设备-->
    <select id="selectAthenaBesEquipmentById" parameterType="Long" resultMap="AthenaBesEquipmentResult">
        <include refid="selectAthenaBesEquipmentVo"/>
        where id = #{id}
    </select>

    <select id="getInfoByCode" parameterType="String" resultMap="AthenaBesEquipmentResult">
        <include refid="selectAthenaBesEquipmentVo"/>
        where code = #{code}
    </select>

    <!--查询物联设备详情-->
    <select id="selectAthenaBesEquipmentInfoById" parameterType="Long" resultType="map">
        select t1.id, t1.product_id productId, t1.p_id pId, t1.code, t1.name, t1.state, t1.ip_address ipAddress,t1.son_address sonAddress,
        t1.port_num portNum, t1.remark,
        t1.create_time createTime, t1.create_name createName, t1.update_time updateTime, t1.update_name updateName,
        (SELECT dict_label FROM sys_dict_data where dict_type = 'communication_protocol_product' and dict_value = t2.communication_protocol)
        communication,
        (SELECT agreement_name FROM athena_bes_agreement where id = t2.message_protocol)
        message,
        (SELECT dict_label FROM sys_dict_data where dict_type = 'iot_type' and dict_value = t2.iot_type) iotName,
        t1.network_type,
        concat(t2.name,' ',t2.code) productName,
        concat(t6.category_name,' ',t6.category_mark) categoryName
        from athena_bes_equipment t1
        left join athena_bes_product t2 on t1.product_id = t2.id
        left join athena_bes_category t6 on t2.category_id = t6.id
        where t1.id = #{id}
    </select>

    <!--新增物联设备-->
    <insert id="insertAthenaBesEquipment" parameterType="Equipment">
        insert into athena_bes_equipment
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="pId != null">p_id,</if>
            <if test="productId != null">product_id,</if>
            <if test="code != null and code != ''">code,</if>
            <if test="name != null and name != ''">name,</if>
            <if test="state != null">state,</if>
            <if test="ipAddress != null">ip_address,</if>
            <if test="sonAddress != null">son_address,</if>
            <if test="portNum != null">port_num,</if>
            <if test="networkType != null">network_type,</if>
            <if test="remark != null">remark,</if>
            <if test="createTime != null">create_time,</if>
            <if test="createName != null">create_name,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="updateName != null">update_name,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="pId != null">#{pId},</if>
            <if test="productId != null">#{productId},</if>
            <if test="code != null and code != ''">#{code},</if>
            <if test="name != null and name != ''">#{name},</if>
            <if test="state != null">#{state},</if>
            <if test="ipAddress != null">#{ipAddress},</if>
            <if test="sonAddress != null">#{sonAddress},</if>
            <if test="portNum != null">#{portNum},</if>
            <if test="networkType != null">#{networkType},</if>
            <if test="remark != null">#{remark},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="createName != null">#{createName},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="updateName != null">#{updateName},</if>
         </trim>
    </insert>

    <!--修改物联设备-->
    <update id="updateAthenaBesEquipment" parameterType="Equipment">
        update athena_bes_equipment
        <trim prefix="SET" suffixOverrides=",">
            <if test="productId != null">product_id = #{productId},</if>
            <if test="code != null and code != ''">code = #{code},</if>
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="state != null">state = #{state},</if>
            <if test="ipAddress != null">ip_address = #{ipAddress},</if>
            <if test="sonAddress != null">son_address = #{sonAddress},</if>
            <if test="portNum != null">port_num = #{portNum},</if>
            <if test="networkType != null">network_type = #{networkType},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="createName != null">create_name = #{createName},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="updateName != null">update_name = #{updateName},</if>
        </trim>
        where id = #{id}
    </update>

    <!--删除物联设备-->
    <delete id="deleteAthenaBesEquipmentById" parameterType="Long">
        delete from athena_bes_equipment where id = #{id}
    </delete>

    <!--删除所有物联子设备-->
    <delete id="deleteSonAthenaBesEquipmentByIds" parameterType="Long">
        delete from athena_bes_equipment where p_id = #{id}
    </delete>

    <!--批量删除物联设备-->
    <delete id="deleteAthenaBesEquipmentByIds" parameterType="String">
        delete from athena_bes_equipment where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
</mapper>
package com.ruoyi.deviceManagement.deviceTreeNode.service.impl;

import java.util.List;
import com.ruoyi.common.utils.DateUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import com.ruoyi.deviceManagement.deviceTreeNode.mapper.AthenaDeviceNodeMapper;
import com.ruoyi.deviceManagement.deviceTreeNode.domain.AthenaDeviceNode;
import com.ruoyi.deviceManagement.deviceTreeNode.service.AthenaDeviceNodeService;
import org.springframework.transaction.annotation.Transactional;

/**
 * 树节点定义Service业务层处理
 *
 * @author ruoyi
 * @date 2022-09-06
 */
@Service
public class AthenaDeviceNodeServiceImpl implements AthenaDeviceNodeService
{
    @Autowired
    private AthenaDeviceNodeMapper athenaDeviceNodeMapper;

    /**
     * 查询树节点定义
     *
     * @param deviceNodeId 树节点定义主键
     * @return 树节点定义
     */
    @Override
    public AthenaDeviceNode selectAthenaDeviceNodeByDeviceNodeId(Long deviceNodeId)
    {
        return athenaDeviceNodeMapper.selectAthenaDeviceNodeByDeviceNodeId(deviceNodeId);
    }

    /**
     * 查询树节点定义列表
     *
     * @param athenaDeviceNode 树节点定义
     * @return 树节点定义
     */
    @Override
    public List<AthenaDeviceNode> selectAthenaDeviceNodeList(AthenaDeviceNode athenaDeviceNode)
    {
        return athenaDeviceNodeMapper.selectAthenaDeviceNodeList(athenaDeviceNode);
    }

    /**
     * 新增树节点定义
     *
     * @param athenaDeviceNode 树节点定义
     * @return 结果
     */
    @Override
    public int insertAthenaDeviceNode(AthenaDeviceNode athenaDeviceNode)
    {
        athenaDeviceNode.setCreateTime(DateUtils.getNowDate());
        return athenaDeviceNodeMapper.insertAthenaDeviceNode(athenaDeviceNode);
    }

    @Override
    public int selectAthenaDeviceNodeCount(AthenaDeviceNode athenaDeviceNode) {
        return athenaDeviceNodeMapper.selectAthenaDeviceNodeCount(athenaDeviceNode);
    }

    @Override
    public List<AthenaDeviceNode> selectAthenaDeviceNodeDelete(Long[] deviceNodeIds) {
        return athenaDeviceNodeMapper.selectAthenaDeviceNodeDelete(deviceNodeIds);
    }

    @Override
    public List<AthenaDeviceNode> selectAthenaDeviceNodeDeleteList(Long[] deviceNodeIds) {
        return athenaDeviceNodeMapper.selectAthenaDeviceNodeDeleteList(deviceNodeIds);
    }

    /**
     * 修改树节点定义
     *
     * @param athenaDeviceNode 树节点定义
     * @return 结果
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean updateAthenaDeviceNode(AthenaDeviceNode athenaDeviceNode)
    {
        //先修改数据
        athenaDeviceNode.setUpdateTime(DateUtils.getNowDate());
        //取出之前旧数据
        AthenaDeviceNode data=athenaDeviceNodeMapper.selectAthenaDeviceNodeByDeviceNodeId(athenaDeviceNode.getDeviceNodeId());
        //先更新数据
        athenaDeviceNodeMapper.updateAthenaDeviceNode(athenaDeviceNode);
        //再修改功能点名称
        if (!data.getDeviceNodeName().equals(athenaDeviceNode.getDeviceNodeName())){
            athenaDeviceNodeMapper.updateStringByFunName(data.getDeviceNodeName(),athenaDeviceNode.getDeviceNodeName());
        }

        return true;
    }

    /**
     * 批量删除树节点定义
     *
     * @param deviceNodeIds 需要删除的树节点定义主键
     * @return 结果
     */
    @Override
    public int deleteAthenaDeviceNodeByDeviceNodeIds(Long[] deviceNodeIds)
    {
        return athenaDeviceNodeMapper.deleteAthenaDeviceNodeByDeviceNodeIds(deviceNodeIds);
    }

    /**
     * 删除树节点定义信息
     *
     * @param deviceNodeId 树节点定义主键
     * @return 结果
     */
    @Override
    public int deleteAthenaDeviceNodeByDeviceNodeId(Long deviceNodeId)
    {
        return athenaDeviceNodeMapper.deleteAthenaDeviceNodeByDeviceNodeId(deviceNodeId);
    }
}

package com.ruoyi.deviceSynchronization.task;

import com.alibaba.fastjson.JSONObject;
import com.ruoyi.common.core.redis.RedisCache;
import com.ruoyi.deviceManagement.deviceTree.domain.DeviceTree;
import com.ruoyi.deviceManagement.deviceTree.service.ControllerService;
import com.ruoyi.deviceSynchronization.mapper.AthenaBesTimeTaskSyncSbMapper;
import com.ruoyi.quartz.domain.SysJob;
import com.zc.common.constant.RedisKeyConstants;
import org.quartz.Job;
import org.quartz.JobExecutionContext;
import org.quartz.JobExecutionException;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;
import java.util.List;

/**
 * description:定时任务
 * author: sunshangeng
 * date:2022/11/4 11:52
 */
@Component("besTask")
public class BesExecute {


    /**会将当前的执行任务的job信息传送过来*/
    private  SysJob job;

    @Resource
    private AthenaBesTimeTaskSyncSbMapper taskSyncSbMapper;

    @Resource
    private RedisCache redisCache;

    @Resource
    private ControllerService controllerService;

//    执行定时同步设备树
    public void executeTimeTaskSyncInfo() {

//        List<String> list = taskSyncSbMapper.selectNodeIdBySyncId(job.getJobId()+"");
//        for (String treeid : list) {
//            DeviceTree tree=redisCache.getCacheMapValue(RedisKeyConstants.BES_BasicData_DeviceTree,treeid);
//            controllerService.synchronizeDDC((long)tree.getDeviceTreeId(),tree.getDeviceType(),false);
//        }
        System.out.println("定时同步设备树走了***********************************:sysJob" + JSONObject.toJSONString(job));
    }


}
